<div class="user-fiche-container" *ngIf="user; else loading">
  <div class="card">
    <div class="card-header">
      <h2>{{ user?.firstName }} {{ user?.lastName }}</h2>
      <button class="btn btn-secondary" (click)="goBack()">← Retour</button>
    </div>

    <div class="profile-section">
      <img
        class="profile-pic"
        [src]="user?.profileImage || 'assets/default-profile.png'"
        alt="Photo de {{ user?.firstName }} {{ user?.lastName }}"
      />

      <div class="info">
        <label>Nom complet :</label>
        <ng-container *ngIf="editMode; else viewName">
          <input [(ngModel)]="user.firstName" placeholder="Prénom" />
          <input [(ngModel)]="user.lastName" placeholder="Nom" />
        </ng-container>
        <ng-template #viewName>
          <p>{{ user?.firstName }} {{ user?.lastName }}</p>
        </ng-template>

        <label>Email :</label>
        <ng-container *ngIf="editMode; else viewEmail">
          <input [(ngModel)]="user.email" />
        </ng-container>
        <ng-template #viewEmail>
          <p>{{ user?.email }}</p>
        </ng-template>

        <label>Rôle :</label>
        <ng-container *ngIf="editMode; else viewRole">
          <select [(ngModel)]="user.role">
            <option value="Admin">Administrateur</option>
            <option value="User">Utilisateur</option>
            <option value="Moderator">Modérateur</option>
          </select>
        </ng-container>
        <ng-template #viewRole>
          <p>{{ user?.role }}</p>
        </ng-template>

        <label>Adresse :</label>
        <ng-container *ngIf="editMode; else viewAddress">
          <input [(ngModel)]="user.address" />
        </ng-container>
        <ng-template #viewAddress>
          <p>{{ user?.address }}</p>
        </ng-template>

        <label>Téléphone :</label>
        <ng-container *ngIf="editMode; else viewPhone">
          <input [(ngModel)]="user.phone" />
        </ng-container>
        <ng-template #viewPhone>
          <p>{{ user?.phone }}</p>
        </ng-template>

        <label>Statut :</label>
        <p>
          <span
            [class.active]="user?.status === 'Actif'"
            [class.inactive]="user?.status === 'Inactif'"
          >
            {{ user?.status }}
          </span>
        </p>

        <label>Membre depuis :</label>
        <p>{{ user?.createdAt | date: 'longDate' }}</p>

        <label>Dernière connexion :</label>
        <p>{{ user?.lastLogin | date: 'medium' }}</p>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn-primary" (click)="toggleEdit()">
        {{ editMode ? 'Annuler' : 'Modifier' }}
      </button>

      <button *ngIf="editMode" class="btn btn-success" (click)="saveChanges()">Enregistrer</button>

      <button class="btn btn-danger" (click)="deleteUser()">Supprimer</button>

      <button class="btn btn-warning" (click)="resetPassword()">Réinitialiser le mot de passe</button>
    </div>
  </div>
</div>

<ng-template #loading>
  <p>Chargement des données utilisateur...</p>
</ng-template>
